user nginx;
worker_processes    auto;
include /etc/nginx/modules-enabled/*.conf;

events { 
    worker_connections 1024; 
}

http {

    upstream auth-container {
        server auth-test:11198;
    }

    upstream api-container {
        server api-test:12221;
    }

    server {
        server_tokens off;


        listen  3593;
        root    /usr/share/nginx/html/dist;
        include /etc/nginx/mime.types;
        server_name ctor 45.12.74.222;

        error_page 405 =200 $uri;

        location /api/auth {
            add_header 'Access-Control-Allow-Origin' '*';
            add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
            proxy_pass http://auth-container/api/auth;
        }

        location /api/refresh {
            add_header 'Access-Control-Allow-Origin' '*';
            add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
            proxy_pass http://auth-container/api/refresh;
        }

        location /api/registration {
            add_header 'Access-Control-Allow-Origin' '*';
            add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
            proxy_pass http://api-container/api/registration;
        }

        location ~ /api/user/\w*[a-zA-Z0-9]/projects {
            proxy_pass http://api-container;
        }

        location /api/project/create {
            proxy_pass http://api-container/api/project/create;
        }

        location / {
            add_header 'Access-Control-Allow-Origin' '*';
            add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
            try_files $uri $uri/ /index.html;
        }
    }
}